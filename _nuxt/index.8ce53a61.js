import{r as m,z as T,A as L,B as b,C as O,u as E,D as C,E as M,F as H,_ as N,k as d,l as f,m as v,c as z,G as k,H as D,I as w,J as R,K as F,L as B,M as U,t as P,N as I,v as S,O as V,P as j,Q as q,R as K,S as X,q as A,T as G}from"./entry.6c4cee32.js";import{_ as J}from"./nuxt-icon.vue.139b893a.js";const Q=()=>null;function W(...u){const _=typeof u[u.length-1]=="string"?u.pop():void 0;typeof u[0]!="string"&&u.unshift(_);let[t,r,e={}]=u;if(typeof t!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof r!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");e.server=e.server??!0,e.default=e.default??Q,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0;const a=E(),g=()=>a.isHydrating?a.payload.data[t]:a.static.data[t],y=()=>g()!==void 0;a._asyncData[t]||(a._asyncData[t]={data:m(g()??e.default()),pending:m(!y()),error:T(a.payload._errors,t),status:m("idle")});const n={...a._asyncData[t]};n.refresh=n.execute=(c={})=>{if(a._asyncDataPromises[t]){if(c.dedupe===!1)return a._asyncDataPromises[t];a._asyncDataPromises[t].cancelled=!0}if((c._initial||a.isHydrating&&c._initial!==!1)&&y())return g();n.pending.value=!0,n.status.value="pending";const i=new Promise((o,h)=>{try{o(r(a))}catch(x){h(x)}}).then(o=>{if(i.cancelled)return a._asyncDataPromises[t];let h=o;e.transform&&(h=e.transform(o)),e.pick&&(h=Y(h,e.pick)),n.data.value=h,n.error.value=null,n.status.value="success"}).catch(o=>{if(i.cancelled)return a._asyncDataPromises[t];n.error.value=o,n.data.value=C(e.default()),n.status.value="error"}).finally(()=>{i.cancelled||(n.pending.value=!1,a.payload.data[t]=n.data.value,n.error.value&&(a.payload._errors[t]=M(n.error.value)),delete a._asyncDataPromises[t])});return a._asyncDataPromises[t]=i,a._asyncDataPromises[t]};const s=()=>n.refresh({_initial:!0}),l=e.server!==!1&&a.payload.serverRendered;{const c=H();if(c&&!c._nuxtOnBeforeMountCbs){c._nuxtOnBeforeMountCbs=[];const o=c._nuxtOnBeforeMountCbs;c&&(L(()=>{o.forEach(h=>{h()}),o.splice(0,o.length)}),b(()=>o.splice(0,o.length)))}l&&a.isHydrating&&y()?(n.pending.value=!1,n.status.value=n.error.value?"error":"success"):c&&(a.payload.serverRendered&&a.isHydrating||e.lazy)&&e.immediate?c._nuxtOnBeforeMountCbs.push(s):e.immediate&&s(),e.watch&&O(e.watch,()=>n.refresh());const i=a.hook("app:data:refresh",o=>{if(!o||o.includes(t))return n.refresh()});c&&b(i)}const p=Promise.resolve(a._asyncDataPromises[t]).then(()=>n);return Object.assign(p,n),p}function Y(u,_){const t={};for(const r of _)t[r]=u[r];return t}const Z={},ee={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},se=v("path",{d:"M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z",stroke:"#3300FF"},null,-1),te=[se];function ae(u,_){return d(),f("svg",ee,te)}const ne=N(Z,[["render",ae]]);function re(u,_={}){const t=[u];for(const[r,e]of Object.entries(_))e===!0?t.push(`${u}--${r}`):e&&t.push(`${u}--${r}--${e}`);return t.join(" ")}const oe={class:"app-progress"},le={class:"app-progress__bar-line"},ce=v("span",{class:"app-progress__value"},"0",-1),ue={key:0},ie={__name:"AppProgress",props:{stages:{type:Array}},setup(u){const _=u;function t(s){let l=0;const p=[...s];for(;p.length>0;){const c=p.pop();Array.isArray(c.games)&&c.games.forEach(i=>{l+=i.bestResult})}return l}const r=z(()=>t(_.stages)),e=(s=(l=>(l=_.stages)==null?void 0:l.length)())=>`grid-template-columns: repeat(${s}, 1fr);`,a=s=>{const l=r.value>=s.thresholdPoints;return s.games.some(p=>p.isPlayed)&&l},g=(s,l)=>{var c;const p=l>0?_.stages[l-1]:null;return y(r.value,p?p==null?void 0:p.thresholdPoints:0,s.thresholdPoints)||l===0&&r.value===0||l===((c=_.stages)==null?void 0:c.length)-1&&r.value>=_.stages[l].thresholdPoints},y=(s,l,p)=>s>l&&s<=p,n=s=>{const l=_.stages[s],p=s>0?_.stages[s-1]:null,c=p?p.thresholdPoints:0,i=l.thresholdPoints;if(r.value>=i)return 100;if(r.value>=c){const o=i-c;return(r.value-c)/o*100}else return 0};return(s,l)=>{const p=ne,c=J;return d(),f("div",oe,[v("div",{class:"app-progress__icons",style:w(e())},[(d(!0),f(k,null,D(u.stages,(i,o)=>{var h;return d(),f("span",{class:"app-progress__icon",key:o},[o!==((h=u.stages)==null?void 0:h.length)-1?(d(),R(p,{key:0,class:F(("bem"in s?s.bem:C(re))("app-progress__icons-star",{fill:a(i)}))},null,8,["class"])):(d(),R(c,{key:1,class:"app-progress__icons-cup",name:"cup",filled:"",width:"46",height:"24"}))])}),128))],4),v("div",{class:"app-progress__bar",style:w(e())},[(d(!0),f(k,null,D(u.stages,(i,o)=>{var h;return d(),f("div",{class:"app-progress__bar-wrapper",key:o},[B(v("span",le,null,512),[[U,o<((h=u.stages)==null?void 0:h.length)-1]]),v("div",{class:"app-progress__bar-fill",style:w({width:`${n(o)}%`})},null,4)])}),128))],4),v("div",{class:"app-progress__values",style:w(e())},[ce,(d(!0),f(k,null,D(u.stages,(i,o)=>(d(),f("span",{class:"app-progress__value",key:o,style:w({transform:g(i,o)?"translateX(30%)":""})},[g(i,o)?(d(),f("span",ue,P(C(r))+" / ",1)):I("",!0),S(P(i.thresholdPoints),1)],4))),128))],4)])}}},pe=ie,$=V("progress",()=>{const u=m([]);return{stages:u,getStages:async()=>{try{const r=await $fetch("list");u.value=r.stages}catch(r){console.error(r.status)}},updateProgress:async({id:r,game:e,progress:a})=>{if(!a)return;const g=u.value.find(s=>s.id===r);if(!g)return;const y=g.games.find(s=>s.name===e);if(!y)return;y.bestResult=+a,g.games.reduce((s,l)=>s+l.bestResult,0)>=g.thresholdPoints&&g.games.forEach(s=>{s.isPlayed=!0})}}}),_e=["id"],de=["onClick"],fe={__name:"AppChangeProgress",props:{stages:{type:Array,required:!0}},setup(u){const{updateProgress:_}=$(),t=m(!1),r=m(null),e=m(null),a=m(null),g=(n,s)=>r.value===s&&e.value===n?"Сохранить":"Изменить прогресс",y=(n,s,l)=>{t.value?r.value===l&&e.value===n&&(_({id:n,game:s,progress:a.value}),t.value=!1,r.value=null,e.value=null,a.value=null):(r.value=l,e.value=n,t.value=!0)};return(n,s)=>(d(),f("div",null,[(d(!0),f(k,null,D(u.stages,(l,p)=>(d(),f("div",{key:p},[S(P(l.name)+" ",1),v("ul",null,[(d(!0),f(k,null,D(l.games,(c,i)=>(d(),f("li",{key:i},[v("p",null,"Название игры: "+P(c.name),1),v("p",null,"Прогресс: "+P(c.bestResult),1),C(t)&&C(e)===l.id&&C(r)===i?B((d(),f("input",{key:0,type:"tel",id:p,"onUpdate:modelValue":s[0]||(s[0]=o=>q(a)?a.value=o:null)},null,8,_e)),[[j,C(a)]]):I("",!0),v("button",{onClick:o=>y(l.id,c.name,i)},P(g(l.id,i)),9,de)]))),128))])]))),128))]))}},ge=fe;const he={class:"page-home"},ve={class:"container"},ye=v("p",null,"Изменение прогресса",-1),Pe={__name:"index",async setup(u){let _,t;const{getStages:r}=$(),{stages:e}=K($());return console.log(G().public.API_URL),m(null),[_,t]=X(()=>W(()=>r(),"$PslAyef5YX")),await _,t(),(g,y)=>{const n=pe,s=ge;return d(),f("div",he,[v("div",ve,[A(n,{stages:C(e)},null,8,["stages"]),ye,A(s,{stages:C(e)},null,8,["stages"])])])}}};export{Pe as default};
