import{r as v,z as T,A as L,B as D,C as O,u as N,D as P,E,F as M,_ as H,k as f,l as _,m,c as z,G as w,H as R,I as b,J as $,K as F,L as B,M as U,t as C,N as S,v as I,O as V,P as j,Q as J,R as q,S as K,q as A,T as X}from"./entry.455930f3.js";import{_ as G}from"./nuxt-icon.vue.b784d3fa.js";const Q=()=>null;function W(...c){const i=typeof c[c.length-1]=="string"?c.pop():void 0;typeof c[0]!="string"&&c.unshift(i);let[s,u,e={}]=c;if(typeof s!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof u!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");e.server=e.server??!0,e.default=e.default??Q,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0;const t=N(),y=()=>t.isHydrating?t.payload.data[s]:t.static.data[s],g=()=>y()!==void 0;t._asyncData[s]||(t._asyncData[s]={data:v(y()??e.default()),pending:v(!g()),error:T(t.payload._errors,s),status:v("idle")});const a={...t._asyncData[s]};a.refresh=a.execute=(l={})=>{if(t._asyncDataPromises[s]){if(l.dedupe===!1)return t._asyncDataPromises[s];t._asyncDataPromises[s].cancelled=!0}if((l._initial||t.isHydrating&&l._initial!==!1)&&g())return y();a.pending.value=!0,a.status.value="pending";const p=new Promise((o,h)=>{try{o(u(t))}catch(x){h(x)}}).then(o=>{if(p.cancelled)return t._asyncDataPromises[s];let h=o;e.transform&&(h=e.transform(o)),e.pick&&(h=Y(h,e.pick)),a.data.value=h,a.error.value=null,a.status.value="success"}).catch(o=>{if(p.cancelled)return t._asyncDataPromises[s];a.error.value=o,a.data.value=P(e.default()),a.status.value="error"}).finally(()=>{p.cancelled||(a.pending.value=!1,t.payload.data[s]=a.data.value,a.error.value&&(t.payload._errors[s]=E(a.error.value)),delete t._asyncDataPromises[s])});return t._asyncDataPromises[s]=p,t._asyncDataPromises[s]};const r=()=>a.refresh({_initial:!0}),n=e.server!==!1&&t.payload.serverRendered;{const l=M();if(l&&!l._nuxtOnBeforeMountCbs){l._nuxtOnBeforeMountCbs=[];const o=l._nuxtOnBeforeMountCbs;l&&(L(()=>{o.forEach(h=>{h()}),o.splice(0,o.length)}),D(()=>o.splice(0,o.length)))}n&&t.isHydrating&&g()?(a.pending.value=!1,a.status.value=a.error.value?"error":"success"):l&&(t.payload.serverRendered&&t.isHydrating||e.lazy)&&e.immediate?l._nuxtOnBeforeMountCbs.push(r):e.immediate&&r(),e.watch&&O(e.watch,()=>a.refresh());const p=t.hook("app:data:refresh",o=>{if(!o||o.includes(s))return a.refresh()});l&&D(p)}const d=Promise.resolve(t._asyncDataPromises[s]).then(()=>a);return Object.assign(d,a),d}function Y(c,i){const s={};for(const u of i)s[u]=c[u];return s}const Z={},ee={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},se=m("path",{d:"M8.9059 1.13178C8.9154 1.10294 8.92794 1.09136 8.93812 1.08452C8.95159 1.07546 8.9731 1.06763 9 1.06763C9.02689 1.06763 9.04841 1.07546 9.06188 1.08452C9.07206 1.09136 9.0846 1.10294 9.0941 1.13178L10.8086 6.33558C10.9574 6.78724 11.3812 7.08682 11.8525 7.08682H17.4006C17.4359 7.08682 17.4531 7.09655 17.4627 7.10389C17.4752 7.11343 17.4876 7.12945 17.4947 7.15098C17.5018 7.17252 17.5009 7.19123 17.4972 7.20373C17.4946 7.21254 17.4881 7.22832 17.461 7.24775L12.9725 10.4639C12.587 10.7401 12.4222 11.2335 12.5715 11.6864L14.2859 16.8902C14.2954 16.919 14.2917 16.9339 14.2886 16.9426C14.284 16.9552 14.2729 16.9723 14.2523 16.987C14.2317 17.0017 14.2099 17.0082 14.1922 17.0088C14.1783 17.0092 14.1587 17.0065 14.1314 16.987L9.64288 13.7709C9.25908 13.4959 8.74092 13.4959 8.35712 13.7709L3.86859 16.987C3.84135 17.0065 3.82174 17.0092 3.8078 17.0088C3.79014 17.0082 3.76828 17.0017 3.74772 16.987C3.72714 16.9723 3.71601 16.9552 3.71144 16.9426C3.70827 16.9339 3.70459 16.919 3.71405 16.8902L5.42852 11.6864C5.57775 11.2335 5.41295 10.7401 5.02751 10.4639L0.538985 7.24775C0.511869 7.22832 0.505441 7.21254 0.502831 7.20373C0.499129 7.19123 0.498223 7.17251 0.505318 7.15098C0.512411 7.12945 0.524794 7.11342 0.537297 7.10389C0.546916 7.09655 0.56409 7.08682 0.599422 7.08682H6.14755C6.61885 7.08682 7.04263 6.78724 7.19143 6.33559L8.9059 1.13178Z",stroke:"#3300FF"},null,-1),te=[se];function ae(c,i){return f(),_("svg",ee,te)}const ne=H(Z,[["render",ae]]);function re(c,i={}){const s=[c];for(const[u,e]of Object.entries(i))e===!0?s.push(`${c}--${u}`):e&&s.push(`${c}--${u}--${e}`);return s.join(" ")}const oe={class:"app-progress"},le={class:"app-progress__bar-line"},ue=m("span",{class:"app-progress__value"},"0",-1),ce={key:0},ie={__name:"AppProgress",props:{stages:{type:Array}},setup(c){const i=c;function s(r){let n=0;const d=[...r];for(;d.length>0;){const l=d.pop();Array.isArray(l.games)&&l.games.forEach(p=>{n+=p.bestResult})}return n}const u=z(()=>s(i.stages)),e=(r=(n=>(n=i.stages)==null?void 0:n.length)())=>`grid-template-columns: repeat(${r}, 1fr);`,t=r=>{const n=u.value>=r.thresholdPoints;return r.games.some(d=>d.isPlayed)&&n},y=(r,n)=>{var l;const d=n>0?i.stages[n-1]:null;return g(u.value,d?d==null?void 0:d.thresholdPoints:0,r.thresholdPoints)||n===0&&u.value===0||n===((l=i.stages)==null?void 0:l.length)-1&&u.value>=i.stages[n].thresholdPoints},g=(r,n,d)=>r>n&&r<=d,a=r=>{const n=i.stages[r],d=r>0?i.stages[r-1]:null,l=d?d.thresholdPoints:0,p=n.thresholdPoints;if(u.value>=p)return 100;if(u.value>=l){const o=p-l;return(u.value-l)/o*100}else return 0};return(r,n)=>{const d=ne,l=G;return f(),_("div",oe,[m("div",{class:"app-progress__icons",style:b(e())},[(f(!0),_(w,null,R(c.stages,(p,o)=>{var h;return f(),_("span",{class:"app-progress__icon",key:o},[o!==((h=c.stages)==null?void 0:h.length)-1?(f(),$(d,{key:0,class:F(("bem"in r?r.bem:P(re))("app-progress__icons-star",{fill:t(p)}))},null,8,["class"])):(f(),$(l,{key:1,class:"app-progress__icons-cup",name:"cup",filled:"",width:"46",height:"24"}))])}),128))],4),m("div",{class:"app-progress__bar",style:b(e())},[(f(!0),_(w,null,R(c.stages,(p,o)=>{var h;return f(),_("div",{class:"app-progress__bar-wrapper",key:o},[B(m("span",le,null,512),[[U,o<((h=c.stages)==null?void 0:h.length)-1]]),m("div",{class:"app-progress__bar-fill",style:b({width:`${a(o)}%`})},null,4)])}),128))],4),m("div",{class:"app-progress__values",style:b(e())},[ue,(f(!0),_(w,null,R(c.stages,(p,o)=>(f(),_("span",{class:"app-progress__value",key:o,style:b({transform:y(p,o)?"translateX(30%)":""})},[y(p,o)?(f(),_("span",ce,C(P(u))+" / ",1)):S("",!0),I(C(p.thresholdPoints),1)],4))),128))],4)])}}},de=ie,k=V("progress",()=>{const c=[{name:"Этап первый",id:1,thresholdPoints:25,games:[{name:"Игра 1.1",bestResult:30,isPlayed:!1}]},{name:"Этап второй",id:2,thresholdPoints:50,games:[{name:"Игра 2.1",bestResult:0,isPlayed:!1}]},{id:3,name:"Этап третий",thresholdPoints:100,games:[{name:"Игра 3.1",bestResult:0,isPlayed:!1}]},{id:4,name:"Этап четвертый",thresholdPoints:200,games:[{name:"Игра 4.1",bestResult:0,isPlayed:!1}]},{id:5,name:"Этап пятый",thresholdPoints:500,games:[{name:"Игра 5.1",bestResult:0,isPlayed:!1}]},{id:6,name:"Этап шестой",thresholdPoints:1e3,games:[{name:"Игра 6.1",bestResult:0,isPlayed:!1},{name:"Игра 6.2",bestResult:0,isPlayed:!1}]}],i=v([]);return{stages:i,getStages:async()=>{try{const e=await $fetch("list");i.value=e.stages}catch(e){i.value=JSON.parse(JSON.stringify(c)),console.error(e)}},updateProgress:async({id:e,game:t,progress:y})=>{if(!y)return;const g=i.value.find(n=>n.id===e);if(!g)return;const a=g.games.find(n=>n.name===t);if(!a)return;a.bestResult=+y,g.games.reduce((n,d)=>n+d.bestResult,0)>=g.thresholdPoints&&g.games.forEach(n=>{n.isPlayed=!0})}}}),pe=["id"],fe=["onClick"],_e={__name:"AppChangeProgress",props:{stages:{type:Array,required:!0}},setup(c){const{updateProgress:i}=k(),s=v(!1),u=v(null),e=v(null),t=v(null),y=(a,r)=>u.value===r&&e.value===a?"Сохранить":"Изменить прогресс",g=(a,r,n)=>{s.value?u.value===n&&e.value===a&&(i({id:a,game:r,progress:t.value}),s.value=!1,u.value=null,e.value=null,t.value=null):(u.value=n,e.value=a,s.value=!0)};return(a,r)=>(f(),_("div",null,[(f(!0),_(w,null,R(c.stages,(n,d)=>(f(),_("div",{key:d},[I(C(n.name)+" ",1),m("ul",null,[(f(!0),_(w,null,R(n.games,(l,p)=>(f(),_("li",{key:p},[m("p",null,"Название игры: "+C(l.name),1),m("p",null,"Прогресс: "+C(l.bestResult),1),P(s)&&P(e)===n.id&&P(u)===p?B((f(),_("input",{key:0,type:"tel",id:d,"onUpdate:modelValue":r[0]||(r[0]=o=>J(t)?t.value=o:null)},null,8,pe)),[[j,P(t)]]):S("",!0),m("button",{onClick:o=>g(n.id,l.name,p)},C(y(n.id,p)),9,fe)]))),128))])]))),128))]))}},he=_e;const ge={class:"page-home"},me={class:"container"},ye=m("p",null,"Изменение прогресса",-1),Ce={__name:"index",async setup(c){let i,s;const{getStages:u}=k(),{stages:e}=q(k());return console.log(X().public.API_URL),v(null),[i,s]=K(()=>W(()=>u(),"$PslAyef5YX")),await i,s(),(y,g)=>{const a=de,r=he;return f(),_("div",ge,[m("div",me,[A(a,{stages:P(e)},null,8,["stages"]),ye,A(r,{stages:P(e)},null,8,["stages"])])])}}};export{Ce as default};
